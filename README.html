<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
	"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">

<head>
<title>README.html</title>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>

</head>

<body>

<h1 id="node-red-contrib-sprinkler">Node-red-contrib-sprinkler</h1>
<p>The most powerful sprinkler and irrigation controller.</p>
<p>Need to set up complex programs? Set different schedules for summer and winter? Adjust watering based on rain levels, humidity, and forecasts all at once? Pause a program for debugging? Send notifications when a zone turns on? Use your own UI? Connect to OpenSprinkler? MQTT? GPIO pins?</p>
<h2 id="getting-started">Getting started</h2>
<figure>
<img src="./screenshots/timer-sequence.png" alt="" /><figcaption>Sequence of zone-timer nodes</figcaption>
</figure>
<p>Create a sequence of <strong>zone timer</strong> nodes. Here, each timer duration is set to <code>3s</code>. To create the sequence, you’ll need to define a program. Programs here are very similar to the concept of “program” traditionally used in irrigation systems: A program is a sequence of zones turned on for different durations. There are some more things to know about programs, but these will be explained later.</p>
<p>For debugging, connect an inject node to the beginning so you can trigger the program. In a real flow, you likely set the inject node to repeat at a certain time and on certain days. For more control, you may wan to use an advanced timer node like <a href="https://flows.nodered.org/node/node-red-contrib-eztimer">eztimer</a> or <a href="https://flows.nodered.org/node/node-red-contrib-bigtimer">bigtimer</a>. Note that for <strong>bigtimer</strong>, you’ll have to put a switch node after to ignore the off events, otherwise your program will run twice per day!</p>
<p>After you assemble your schedule, you’ll likely want to actually control your irrigation hardware. A <strong>zone in</strong> node will send messages whenever a zone turns on or off. You can connect it to: - a debug node for debugging - the built-in <strong>opensprinkler</strong> node if your device runs OpenSprinkler - a template node to transform the zone name into an MQTT topic and then an MQTT node - an http request node, GPIO control node, or anything else you can imagine</p>
<blockquote>
<p><strong>NOTE</strong>: While you can in theory have node-red running on one machine and control hardware an another machine over the network, it is best to run node-red directly on the hardware controlling your sprinklers. If your network fails, your sprinklers can keep running!</p>
</blockquote>
<h3 id="timer-control">Timer control</h3>
<p>Sometimes you may wish to temporarily pause your sprinkler program if there’s a lot of rain. You may also wish to temporarily increase or decrease the amount of time a zone is set to run. You can use a <strong>timerctl out</strong> node to accomplish both these tasks. These actions don’t have to be manual. You could connect a weather-detecting node to the <strong>timerctl out</strong> to automatically pause when it is raining! But be sure to uncheck the <em>“Pause only when program is running”</em> so that your program doesn’t run when paused!</p>
<h2 id="dashboards">Dashboards</h2>
<p>You may be curious what your sprinkler setup is doing behind your back. Perhaps you’d like to know which zones are on or how much more time a zone will be on for. You can use both the <strong>zone in</strong> node and <strong>timerctl in</strong> nodes to connect to dashboard labels.</p>
<figure>
<img src="./screenshots/dashboard.png" alt="" /><figcaption>Using sprinkler nodes with dashboard nodes</figcaption>
</figure>
<p>This example uses the <a href="https://flows.nodered.org/node/node-red-dashboard">node-red-dashboard</a> module. You can make a much more complex dashboard than this example , so make sure to check out the module documentation!</p>
<h2 id="node-documentation">Node Documentation</h2>
<p>There’s a lot of it, so it’s best to just install the extension then view the docs insine Node-RED’s Help pane.</p>
<h2 id="how-it-works">How it works</h2>
<p>From a technical standpoint, each node (<strong>zone-timer</strong>, <strong>zone-in</strong>, <strong>zone-out</strong>, etc) is merely a simple interface to its connected <strong>program</strong> configuration node. The program node serves as a combination of a state machine and message bus.</p>
<h3 id="program-state-machine">Program state machine</h3>
<figure>
<img src="./screenshots/statediagram.png" alt="" /><figcaption>Visual representation of program state machine</figcaption>
</figure>
<p>Each program runs a timer. A visual representation of the various states of the timer are shown above. Both <strong>zone-timer</strong> and <strong>timerctl out</strong> nodes cause the state machine to transition. A <strong>zone-timer</strong> will issue the “start” transition, upon which the timer will start ticking and move itself back to the “stopped” state when the timer reaches zero. The <strong>timerctl out</strong> issues the “resume” and “pause” transitions, and if the <em>“Pause only when program is running”</em> option is checked, messages with pause &amp; reset topics will cause “block” and “unblock” transitions as well.</p>
<h3 id="program-message-bus">Program message bus</h3>
<p>Another important function of the program is to act as a message bus, which simplifies wiring inside node-red. Whenever a zone is turned on or off, the <strong>zone-timer</strong> or <strong>zone-out</strong> node will send a message to change the zone over the program’s message bus. The <strong>zone-in</strong> node will listen for these messages and send the appropriate message to connected nodes.</p>
<p>Below is a depiction of the messages sent to and from the program node internally.</p>
<figure>
<img src="./screenshots/bigdiagram.png" alt="" /><figcaption>Visual representation of how messages are routed</figcaption>
</figure>

</body>
</html>
